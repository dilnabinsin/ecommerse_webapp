<%- include('../partials/user/header') %>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<%- include("../../views/partials/user/loader") %>
<script src="main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.0/dist/sweetalert2.all.min.js"></script>

<style>
    /* Global Styles */
    body {
        font-family: 'Poppins', sans-serif;
        color: #333;
        background-color: #f9f9f9;
    }

    .banner-area {
        background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/img/banner.jpg');
        background-size: cover;
        background-position: center;
        color: #fff;
        padding: 100px 0;
        text-align: center;
    }

    .banner-area h1 {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 20px;
    }

    .banner-area nav a {
        color: #fff;
        text-decoration: none;
        margin: 0 10px;
        font-size: 1rem;
    }

    .banner-area nav a:hover {
        color: #007bff;
    }

    .product_image_area {
        padding: 50px 0;
    }

    .s_product_inner {
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .main-image-container {
        position: relative;
        overflow: hidden;
        border-radius: 10px;
        margin-bottom: 20px;
        max-width: 300px; /* Further reduced width */
        margin: 0 auto; /* Center the main image */
    }

    .main-image {
        width: 100%; /* Ensure the image fills the container */
        border-radius: 10px;
        transition: transform 0.3s ease;
        cursor: zoom-in;
    }

    .thumbnail-gallery {
        display: flex;
        gap: 10px;
        justify-content: center; /* Center the thumbnails */
        margin-top: 20px;
    }

    .thumbnail {
        width: 50px; /* Further reduced thumbnail size */
        height: 50px;
        border-radius: 10px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.3s ease;
    }

    .thumbnail.active {
        border-color: #007bff;
    }

    .thumbnail:hover {
        border-color: #007bff;
    }

    .s_product_text h2 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #222;
        margin-bottom: 10px;
    }

    .s_product_text h5 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #555;
        margin-bottom: 20px;
    }

    .s_product_text h6 {
        font-size: 1.2rem;
        color: #888;
        text-decoration: line-through;
        margin-bottom: 0;
    }

    .s_product_text h4 {
        font-size: 1.2rem;
        color: #28a745;
        font-weight: 600;
        margin-left: 10px;
    }

    .list li {
        margin-bottom: 10px;
        font-size: 1rem;
        color: #666;
    }

    .list li a {
        color: #333;
        text-decoration: none;
    }

    .list li a:hover {
        color: #007bff;
    }

    .primary-btn {
        background-color: #007bff;
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        transition: background-color 0.3s ease;
    }

    .primary-btn:hover {
        background-color: #0056b3;
    }

    .icon_btn {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 50%;
        margin-left: 10px;
        transition: transform 0.3s ease;
    }

    .icon_btn:hover {
        transform: scale(1.1);
        background: #e9ecef;
    }

    .product_description_area {
        padding: 50px 0;
    }

    .nav-tabs .nav-link {
        border: none;
        font-size: 1rem;
        font-weight: 600;
        color: #666;
        padding: 10px 20px;
    }

    .nav-tabs .nav-link.active {
        color: #007bff;
        border-bottom: 2px solid #007bff;
    }

    .tab-content {
        padding: 20px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .review_box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
    }

    .review_box textarea {
        resize: none;
    }

    .related-product-area {
        padding: 50px 0;
        background: #fff;
    }

    .related-product-area .section-title h1 {
        font-size: 2rem;
        font-weight: 700;
        color: #222;
    }

    .related-product-area .section-title p {
        font-size: 1rem;
        color: #666;
    }

    .single-related-product {
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }

    .single-related-product:hover {
        transform: translateY(-5px);
    }

    .single-related-product img {
        border-radius: 10px;
    }

    .single-related-product .title {
        font-size: 1rem;
        font-weight: 600;
        color: #333;
        text-decoration: none;
    }

    .single-related-product .price h6 {
        font-size: 1rem;
        color: #28a745;
        font-weight: 700;
    }

    .single-related-product .price .l-through {
        font-size: 0.9rem;
        color: #888;
        text-decoration: line-through;
    }

    /* Review Section Styles */
    .review-section {
        margin-top: 20px;
    }

    .review-section h4 {
        font-size: 1.2rem;
        font-weight: 600;
        color: #222;
        margin-bottom: 10px;
    }

    .review-section .rating {
        display: flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 10px;
    }

    .review-section .rating .fa-star {
        color: #ffc107;
        cursor: pointer;
    }

    .review-section .rating .fa-star:hover {
        color: #ff9800;
    }

    .review-section .review-form {
        margin-top: 20px;
    }

    .review-section .review-form textarea {
        width: 100%;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
        resize: none;
    }

    .review-section .review-form button {
        margin-top: 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .review-section .review-form button:hover {
        background-color: #0056b3;
    }

    /* Rating Display Styles */
    .rating-display {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }

    .rating-display .stars {
        color: #ffc107;
    }

    .rating-display .rating-text {
        font-size: 1rem;
        color: #555;
    }

    /* Icon Grid Styles */
    .icon-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 20px;
    }

    .icon-grid-item {
        text-align: center;
    }

    .icon-grid-item i {
        font-size: 1.5rem;
        color: #007bff;
    }

    .icon-grid-item p {
        font-size: 0.9rem;
        color: #555;
        margin-top: 5px;
    }

    .single-related-product img {
    width: 80px;  /* Adjust thumbnail width */
    height: 80px; /* Adjust thumbnail height */
    object-fit: cover; /* Ensures images stay properly cropped */
    border-radius: 5px; /* Optional: adds rounded corners */
    border: 1px solid #ddd; /* Light border for a clean look */
    padding: 4px; /* Adds spacing inside the border */
}
.related-product-thumb {
    width: 80px; /* Adjust width */
    height: 80px; /* Adjust height */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.related-product-thumb img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Keeps aspect ratio */
}
    </style>
<!-- Start Banner Area -->
<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="/home" rel="nofollow">Home</a>
                <span></span> >
                <a href="/shop" rel="nofollow">SHOP</a>
                <span></span>>
                <span></span>Product Details
            </div>
        </div>
    </div>
   
    
<!-- End Banner Area -->

<!--================Single Product Area =================-->
<div class="product_image_area">
    <div class="container">
        <div class="row s_product_inner">
            <div class="col-lg-6">
                <!-- Main Image -->
                <div class="main-image-container">
                    <img id="mainImage" class="main-image" src="<%= product.productImage[0] %>" alt="Main Product Image">
                </div>
                <!-- Thumbnail Gallery -->
                <div class="thumbnail-gallery">
                    <% product.productImage.forEach((image, index) => { %>
                        <img class="thumbnail <%= index === 0 ? 'active' : '' %>" src="<%= product.productImage[0] %>" alt="Thumbnail <%= index + 1 %>" onclick="changeMainImage('<%= image %>', this)">
                    <% }) %>
                </div>
            </div>
            <div class="col-lg-5 offset-lg-1">
                <div class="s_product_text">
                    <h5><%= product.productName %></h5>

                    <!-- Rating Display -->
                    <div class="rating-display">
                        <div class="stars">
                            <% const averageRating = 5; // Replace with actual average rating %>
                            <% const totalReviews = 5; // Replace with actual total reviews %>
                            <% for (let i = 1; i <= 5; i++) { %>
                                <i class="fa fa-star <%= i <= averageRating ? 'active' : '' %>"></i>
                            <% } %>
                        </div>
                        <div class="rating-text">
                            (<%= averageRating %> out of 5) (<%= totalReviews %> reviews)
                        </div>
                    </div>

                    <h2>₹ <%= product.salePrice.toLocaleString('en-IN') %></h2>
                    <div class="d-flex align-items-center">
                        <h6 class="l-through">₹ <%= product.regularPrice.toLocaleString('en-IN') %></h6>
                        <h4 class="ml-3"><%=product.category.categoryOffer > product.productOffer ? product.category.categoryOffer : product.productOffer %> % Off</h4>
                    </div>
                    <ul class="list">
                        <li><a class="active" href="#"><span>Category</span>: <%= product.category.name %></a></li>
                        <li><a href="#"><span>Availability</span>: <%- product.quantity >= 1 ? '<span style="color: green;">In Stock</span>' : '<span style="color: red;">Out of Stock</span>' %></a></li>
                        <li><a href="#"><span>Color</span>: <%= product.color %></a></li>
                    </ul>
                    <!-- <p><%= product.description %></p> -->
                    <div class="card_area d-flex align-items-center">
                        <a class="primary-btn" href="#" onclick="addToCart('<%= product._id %>')">Add to Cart</a>
                        <a class="icon_btn" href="#" onclick="addToWishlist('<%= product._id %>')">
                            <i class="lnr lnr-heart"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--================End Single Product Area =================-->

<!--================Product Description Area =================-->
<section class="product_description_area">
    <div class="container">
        <ul class="nav nav-tabs" id="productTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="description-tab" data-bs-toggle="tab" 
                        data-bs-target="#description" type="button" role="tab" 
                        aria-controls="description" aria-selected="true">Description</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="washcare-tab" data-bs-toggle="tab" 
                        data-bs-target="#washcare" type="button" role="tab" 
                        aria-controls="washcare" aria-selected="false">WashCare</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" 
                        data-bs-target="#reviews" type="button" role="tab" 
                        aria-controls="reviews" aria-selected="false">Reviews</button>
            </li>
        </ul>
        <div class="tab-content" id="productTabsContent">
            <div class="tab-pane fade show active" id="description" role="tabpanel" 
                 aria-labelledby="description-tab">
                <p><%= product.fulldescription %></p>
            </div>
            <div class="tab-pane fade" id="washcare" role="tabpanel" 
            aria-labelledby="washcare-tab">
           <div class="table-responsive">
               <table class="table">
                   <tbody>
                       <tr>
                           <td><h5>Gentle Wash Recommended</h5></td>
                       </tr>
                       <!-- Add more wash care instructions as needed -->
                   </tbody>
               </table>
           </div>
       </div>
       <div class="tab-pane fade" id="reviews" role="tabpanel" 
         aria-labelledby="reviews-tab">
        <div class="row">
            <div class="col-lg-6">
                <div class="review_list">
                    <div class="review_item">
                        <div class="media">
                            <div class="media-body">
                                <h4>Ammu</h4>
                                <div class="rating">
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                    <i class="fa fa-star"></i>
                                </div>
                                <p>Amazing Product</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="review-section">
                <h4>Customer Reviews</h4>
                <div class="rating">
                    <% for (let i = 1; i <= 5; i++) { %>
                        <i class="fa fa-star" data-rating="<%= i %>"></i>
                    <% } %>
                </div>
                <div class="review-form">
                    <textarea placeholder="Write your review here..." rows="3"></textarea>
                    <button type="button" onclick="submitReview()">Submit Review</button>
                </div>
            </div>
        </div>
    </div>
</div>

</section>
<!--================End Product Description Area =================-->

<!-- Start related-product Area -->
<section class="related-product-area">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6 text-center">
                <div class="section-title">
                    <h1>Related Products</h1>
                    <p>Explore our range of related products that complement your purchase.</p>
                </div>
            </div>
        </div>
        <div class="row">
            <% products.forEach(product => { %>
                <div class="col-lg-4 col-md-4 col-sm-6 mb-20">
                    <div class="single-related-product d-flex">
                        <div class="related-product-thumb">
                            <a href="/productDetails?id=<%= product._id %>"><img src="<%= product.productImage[0] %>" class="img-thumbnail" alt="Related Product"></a>

                        <!-- <a href="#"><img src="<%= product.productImage[0] %>" class="img-thumbnail"  alt="Related Product"></a> -->
                    </div>
                        <div class="desc">
                            <a href="/productDetails?id=<%= product._id %>" class="title"><%= product.productName.split('|')[0] %></a>

                            <!-- <a href="#" class="title"><%= product.productName.split('|')[0] %></a> -->
                            <div class="price">
                                <h6>₹ <%= product.salePrice.toLocaleString('en-IN') %></h6>
                                <h6 class="l-through">₹ <%= product.regularPrice.toLocaleString('en-IN') %></h6>
                            </div>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>
</section>
<!-- End related-product Area -->




</main>
<%- include('../partials/user/footer') %>

<script>
const tabElms = document.querySelectorAll('button[data-bs-toggle="tab"]');
tabElms.forEach(tabElm => {
    tabElm.addEventListener('click', function (event) {
        event.preventDefault();
        const tab = new bootstrap.Tab(this);
        tab.show();
    });
});
    
    // Change main image when thumbnail is clicked
    // Change main image when thumbnail is clicked
    function changeMainImage(src, element) {
        const mainImage = document.getElementById('mainImage');
        mainImage.src = src;

        // Remove active class from all thumbnails
        document.querySelectorAll('.thumbnail').forEach(thumb => {
            thumb.classList.remove('active');
        });

        // Add active class to the clicked thumbnail
        element.classList.add('active');
    }

    // Smooth zoom effect on main image
    const mainImageContainer = document.querySelector('.main-image-container');
    const mainImage = document.getElementById('mainImage');

    mainImageContainer.addEventListener('mousemove', (e) => {
        const { left, top, width, height } = mainImageContainer.getBoundingClientRect();
        const x = (e.pageX - left) / width * 100;
        const y = (e.pageY - top) / height * 100;

        mainImage.style.transformOrigin = `${x}% ${y}%`;
        mainImage.style.transform = 'scale(1.5)';
    });

    mainImageContainer.addEventListener('mouseleave', () => {
        mainImage.style.transform = 'scale(1)';
    });


    function handleAuthError(title, message) {
  return Swal.fire({
    title: title,
    text: message,
    icon: "warning",
    showCancelButton: true,
    confirmButtonText: "Login",
    cancelButtonText: "Cancel",
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = "/login";
    }
  });
}

// Add to wishlist function
function addToWishlist(productId) {
  $.ajax({
    url: '/addToWishlist',
    method: "POST",
    data: { productId: productId },
    success: (response) => {
      if (response.status) {
        Swal.fire({
          title: "Added to Wishlist",
          text: "The product has been added to your wishlist.",
          icon: "success",
          timer: 2000,
          showConfirmButton: false
        });
      } else {
        Swal.fire({
          title: "Already in Wishlist",
          text: response.message,
          icon: "info",
          timer: 2000,
          showConfirmButton: false
        });
      }
    },
    error: (xhr) => {
      if (xhr.status === 401) {
        handleAuthError(
          "Not Logged In",
          "You need to log in to add items to your wishlist."
        );
      } else {
        Swal.fire({
          title: "Error",
          text: "There was an error adding the product to your wishlist.",
          icon: "error",
          timer: 2000,
          showConfirmButton: false
        });
      }
    }
  });
}

// Add to cart function
function addToCart(productId) {
  $.ajax({
    url: '/addToCart',
    method: "POST",
    data: { productId: productId },
    success: (response) => {
      if (response.status) {
        Swal.fire({
			title: "Added to Cart",
			text: response.message,
			icon: "success",
			showCancelButton: true,  // Enables the second button
			confirmButtonText: "Cart", // Redirects to cart
			cancelButtonText: "OK",  // Closes the alert
			timer: 2000
		}).then((result) => {
			if (result.isConfirmed) {
				window.location.href = "/cart"; // Redirects to the cart page
			} else {
				location.reload(); // Reload to update cart UI
			}
		});

      } else {
        Swal.fire({
          title: "Error",
          text: response.message || "Unable to add to cart",
          icon: "error",
          timer: 2000,
          showConfirmButton: false
        });
      }
    },
    error: (xhr) => {
      if (xhr.status === 401) {
        handleAuthError(
          "Not Logged In",
          "You need to log in to add items to your cart."
        );
      } else {
        Swal.fire({
          title: "Error",
          text: "Stock limit reached or maximum 5 items per user",
          icon: "error",
          timer: 2000,
          showConfirmButton: false
        });
      }
    }
  });
}




const stars = document.querySelectorAll('.rating .fa-star');
    let selectedRating = 0;

    stars.forEach(star => {
        star.addEventListener('click', () => {
            selectedRating = star.getAttribute('data-rating');
            stars.forEach((s, index) => {
                if (index < selectedRating) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        });
    });

    // Submit Review
    function submitReview() {
        const reviewText = document.querySelector('.review-form textarea').value;
        if (!selectedRating) {
            alert('Please select a rating.');
            return;
        }
        if (!reviewText) {
            alert('Please write a review.');
            return;
        }

        // Send review data to the server (you can use AJAX here)
        console.log('Rating:', selectedRating);
        console.log('Review:', reviewText);

        alert('Thank you for your review!');
        document.querySelector('.review-form textarea').value = '';
        stars.forEach(star => star.classList.remove('active'));
        selectedRating = 0;
    }

</script>
