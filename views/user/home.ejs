<%- include("../../views/partials/user/header") %>
<%- include("../../views/partials/user/loader") %>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
<link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
<!-- Include Font Awesome CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


<script src="script.js"></script>

<script src="main.js"></script>

<style>
    :root {
        --primary: #1a2526;
        --secondary: #3b4f50;
        --accent: #b7950b;
        --text-light: #f5f5f5;
        --text-dark: #1a2526;
        --bg-light: #ffffff;
    }

    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        font-family: 'Roboto', sans-serif;
        color: var(--text-dark);
        margin: 0;
        padding: 0;
    }

    /* Hero Slider */
    .hero {
        position: relative;
        margin-bottom: 40px;
    }

    .hero__slider .owl-stage-outer {
        overflow: hidden;
    }

    .hero__items {
        position: relative;
        height: 500px;
        background-size: cover;
        background-position: center;
        display: flex;
        align-items: center;
    }

    .hero__items::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1;
    }

    .hero__text {
        position: relative;
        z-index: 2;
        color: var(--text-light);
        padding: 20px;
    }

    .hero__text h2 {
        font-family: 'Playfair Display', serif;
        font-size: 48px;
        margin-bottom: 15px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .hero__text p {
        font-size: 18px;
        margin-bottom: 25px;
    }

    .hero__text .primary-btn {
        background: var(--accent);
        color: var(--text-light);
        padding: 12px 30px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .hero__text .primary-btn:hover {
        background: #d4af37;
        transform: translateY(-2px);
    }

    /* Product Section */
    .product-section {
        padding: 40px 0;
    }

    .section-title {
        text-align: center;
        margin-bottom: 40px;
    }

    .section-title h1 {
        font-family: 'Playfair Display', serif;
        color: var(--primary);
        font-size: 32px;
        margin-bottom: 10px;
        position: relative;
    }

    .section-title h1::after {
        content: '';
        position: absolute;
        width: 50px;
        height: 2px;
        background: var(--accent);
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
    }

    .section-title p {
        font-size: 16px;
        color: var(--text-dark);
    }

    .product__item {
        background: var(--bg-light);
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        transition: transform 0.3s ease;
    }

    .product__item:hover {
        transform: translateY(-10px);
    }

    .product__item__pic {
        position: relative;
        height: 250px;
        background-size: cover;
        background-position: center;
    }

    .product__item__pic .product__label {
        position: absolute;
        top: 10px;
        left: 10px;
        background: var(--accent);
        color: var(--text-light);
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
    }

    .product__item__text {
        padding: 20px;
        text-align: center;
    }

    .product__item__text h6 {
        font-family: 'Playfair Display', serif;
        font-size: 18px;
        color: var(--primary);
        margin-bottom: 10px;
        transition: color 0.3s ease;
    }

    .product__item__text h5 {
        font-size: 16px;
        color: var(--accent);
        margin-bottom: 15px;
    }

    .product__item__text .add-cart-btn {
        background: var(--secondary);
        color: var(--text-light);
        padding: 8px 20px;
        border-radius: 5px;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .product__item__text .add-cart-btn:hover {
        background: var(--accent);
        color: var(--text-light);
    }

    /* Single Product Slider */
    .single-product-slider {
        padding: 40px 0;
    }

    .single-product {
        background: var(--bg-light);
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        transition: transform 0.3s ease;
    }

    .single-product:hover {
        transform: translateY(-10px);
    }

    .single-product img {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }

    .single-product .product-details {
        padding: 15px;
        text-align: center;
    }

    .single-product .product-details h6 {
        font-family: 'Playfair Display', serif;
        font-size: 16px;
        color: var(--primary);
        margin-bottom: 10px;
    }

    .single-product .price h6 {
        font-size: 14px;
        color: var(--accent);
        display: inline-block;
        margin: 0 5px;
    }

    .single-product .price .l-through {
        color: #999;
        text-decoration: line-through;
    }

    .single-product .prd-bottom {
        display: flex;
        justify-content: center;
        gap: 10px;
        padding: 10px;
    }

    .single-product .social-info {
        color: var(--primary);
        text-decoration: none;
        font-size: 14px;
        transition: color 0.3s ease;
    }

    .single-product .social-info:hover {
        color: var(--accent);
    }

    .single-product .social-info span {
        font-size: 18px;
        margin-right: 5px;
    }

    /* Features Area */
    .features-area {
        background: var(--bg-light);
        padding: 40px 0;
    }

    .single-features {
        text-align: center;
        padding: 20px;
        background: var(--secondary);
        color: var(--text-light);
        border-radius: 10px;
        transition: transform 0.3s ease;
    }

    .single-features:hover {
        transform: translateY(-10px);
    }

    .single-features .f-icon img {
        width: 40px;
        height: 40px;
        margin-bottom: 15px;
    }

    .single-features h6 {
        font-family: 'Playfair Display', serif;
        font-size: 18px;
        margin-bottom: 10px;
    }

    .single-features p {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.8);
    }

    /* Responsiveness */
    @media (max-width: 768px) {
        .hero__items {
            height: 400px;
        }
        .hero__text h2 {
            font-size: 32px;
        }
        .hero__text p {
            font-size: 16px;
        }
        .product__item__pic {
            height: 200px;
        }
        .single-product img {
            height: 150px;
        }
        .single-product .product-details h6 {
            font-size: 14px;
        }
    }

    @media (max-width: 576px) {
        .hero__text {
            text-align: center;
        }
        .hero__text h2 {
            font-size: 24px;
        }
        .section-title h1 {
            font-size: 24px;
        }
        .product__item__text h6 {
            font-size: 16px;
        }
        .single-features {
            padding: 15px;
        }
    }
    .product-card img {
    object-fit: cover;
    height: 200px;
    border-top-left-radius: 0.75rem;
    border-top-right-radius: 0.75rem;
}

.card-body h6 {
    font-size: 1rem;
    font-weight: 500;
}

.price span {
    font-size: 1rem;
}

.price small {
    font-size: 0.875rem;
}
button i.ti-shopping-cart {
  margin-right: 5px;
  font-size: 16px;
}

</style>

<!-- Hero Slider -->
<section class="hero">
    <div class="hero__slider owl-carousel">
        <% if (banners && banners.length > 0) { %>
            <% banners.forEach((banner) => { %>
                <div class="hero__items" style="background-image: url('<%= banner.image %>');">
                    <div class="container">
                        <div class="row">
                            <div class="col-xl-5 col-lg-7 col-md-8">
                                <!-- <div class="hero__text">
                                    <h2><%= banner.title %></h2>
                                    <p><%= banner.description %></p>
                                    <a href="/shop" class="primary-btn">Shop Now</a>
                                </div>
                               -->
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <div class="hero__items" style="background-image: url('img/hero/default-banner.jpg');">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-5 col-lg-7 col-md-8">
                            <div class="hero__text">
                                <h2>Welcome to Our Store</h2>
                                <p>Explore our latest collections and find the perfect products for you.</p>
                                <a href="/shop" class="primary-btn">Shop Now</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</section>

<!-- Latest Products -->
<section class="product-section">
    <div class="container">
        <div class="section-title">
            <h1>Latest Products</h1>
            <p>Discover the essence of tradition with our exquisite collection of ethnic wear.</p>
        </div>
        <div class="row product__filter">
            <% products.forEach((product) => { %>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="product__item">
                        <a href="/productDetails?id=<%= product._id %>">
                            <div class="product__item__pic" style="background-image: url('<%= product.productImage[0] %>');">
                                <% if (product.productOffer > 0) { %>
                                    <span class="product__label">Sale</span>
                                <% } %>
                            </div>
                        </a>
                        <div class="product__item__text">
                            <h6><%= product.productName %></h6>
                            <h5>₹<%= product.salePrice %></h5>
                            <a href="#" onclick="addToCart('<%= product._id %>')" class="add-cart-btn">+ Add to Cart</a>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
</section>

<!-- Product Slider -->
<!-- <section class="bg-white py-5">
    <div class="container">
        <div class="section-title">
            <h1>Top Sellers by Category</h1>
        </div>
        <% for (const [catName, products] of Object.entries(mostSellingByCategory)) { %>
            <div class="mb-5">
                <h4 class="mb-4 text-center text-uppercase text-secondary"><%= catName %></h4>
                <div class="row">
                    <% products.forEach(product => { %>
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="card product-card h-100 border-0 shadow-sm">
                                <a href="/productDetails?id=<%= product._id %>">
                                    <img src="<%= product.productImage[0] %>" class="card-img-top" alt="<%= product.productName %>">
                                </a>
                                <div class="card-body text-center">
                                    <h6 class="card-title mb-2"><%= product.productName %></h6>
                                    <div class="price mb-3">
                                        <span class="text-primary fw-bold">₹<%= product.salePrice %></span>
                                        <small class="text-muted text-decoration-line-through ms-2">₹<%= product.regularPrice %></small>
                                    </div>
                                    <button class="btn btn-outline-dark btn-sm me-2" onclick="addToCart('<%= product._id %>')">
                                        <i class="bi bi-bag-plus"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="addToWishlist('<%= product._id %>')">
                                        <i class="bi bi-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        <% } %>
    </div>
</section> -->

    
    <section class="product-section">
        <div class="container">
            <div class="section-title">
                <h1>Most Selling Products</h1>
                <p>Top-selling favorites loved by our customers</p>
            </div>
            <div class="row">
                <% mostSellingProducts.forEach(product => { %>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="single-product">
                            <a href="/productDetails?id=<%= product._id %>">
                                <img src="<%= product.productImage[0] %>" alt="<%= product.productName %>">
                                <div class="product-details">
                                    <h6><%= product.productName %></h6>
                                    <div class="price">
                                        <h6>₹<%= product.salePrice %></h6>
                                        <h6 class="l-through">₹<%= product.regularPrice %></h6>
                                    </div>
                                </div>
                            </a>
                            <div class="prd-bottom">
                                <a href="#" onclick="addToCart('<%= product._id %>')" class="social-info">
                                    <i class="bi bi-cart"></i>
                                    <p class="hover-text"></p>
                                </a>
                                <a href="#" onclick="addToWishlist('<%= product._id %>')" class="social-info">
                                    <span class="lnr lnr-heart"></span>
                                    <p class="hover-text"></p>
                                </a>
                                <!-- <button class="btn btn-outline-secondary btn-sm add-to-wishlist" data-product-id="<%= product._id %>">
                                    <i class="bi bi-heart"></i>
                                </button> -->
                                <a href="/productDetails?id=<%= product._id %>" class="social-info">
                                    <span class="lnr lnr-move"></span>
                                    <p class="hover-text"></p>
                                </a>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
    </section>
</section>

<!-- Features Area -->
<section class="features-area">
    <div class="container">
        <div class="row features-inner">
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="single-features">
                    <div class="f-icon">
                        <img src="img/features/f-icon1.png" alt="Free Delivery">
                    </div>
                    <h6>Free Delivery</h6>
                    <p>Free Shipping on all orders</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="single-features">
                    <div class="f-icon">
                        <img src="img/features/f-icon2.png" alt="Return Policy">
                    </div>
                    <h6>Return Policy</h6>
                    <p>Easy returns on all orders</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="single-features">
                    <div class="f-icon">
                        <img src="img/features/f-icon3.png" alt="24/7 Support">
                    </div>
                    <h6>24/7 Support</h6>
                    <p>Round-the-clock assistance</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="single-features">
                    <div class="f-icon">
                        <img src="img/features/f-icon4.png" alt="Secure Payment">
                    </div>
                    <h6>Secure Payment</h6>
                    <p>Safe and secure transactions</p>
                </div>
            </div>
        </div>
    </div>
</section>

<%- include("../../views/partials/user/footer") %>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
   
		document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute("href"));
            if (target) {
                target.scrollIntoView({ behavior: "smooth" });
            }
        });
    });
});


function handleAuthError(title, message) {
  return Swal.fire({
    title: title,
    text: message,
    icon: "warning",
    showCancelButton: true,
    confirmButtonText: "Login",
    cancelButtonText: "Cancel",
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = "/login";
    }
  });
}

function addToWishlist(productId) {
    if (!productId) {
        console.warn('Product ID missing');
        return;
    }
    showLoader();
    $.ajax({
        url: '/addToWishlist',
        method: 'POST',
        data: { productId: productId },
        success: (response) => {
            hideLoader();
            if (response.status) {
                Swal.fire({
                    title: 'Added to Wishlist',
                    text: 'The product has been added to your wishlist.',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                fetchCartWishlistCount();
            } else {
                Swal.fire({
                    title: 'Already in Wishlist',
                    text: response.message,
                    icon: 'info',
                    timer: 2000,
                    showConfirmButton: false
                });
                fetchCartWishlistCount();
            }
        },
        error: (xhr) => {
            hideLoader();
            if (xhr.status === 401) {
                handleAuthError(
                    'Not Logged In',
                    'You need to log in to add items to your wishlist.'
                );
            } else {
                Swal.fire({
                    title: 'Error',
                    text: 'There was an error adding the product to your wishlist.',
                    icon: 'error',
                    timer: 2000,
                    showConfirmButton: false
                });
            }
        }
    });
}
function addToWishlist1(productId) {
    showLoader();
    $.ajax({
        url: '/addToWishlist',
        method: "POST",
        data: { productId: productId },
        success: (response) => {
            hideLoader();
            if (response.status) {
                Swal.fire({
                    title: "Added to Wishlist",
                    text: "The product has been added to your wishlist.",
                    icon: "success",
                    timer: 2000,
                    showConfirmButton: false
                });
                fetchCartWishlistCount(); // Update navbar counters
            } else {
                Swal.fire({
                    title: "Already in Wishlist",
                    text: response.message,
                    icon: "info",
                    timer: 2000,
                    showConfirmButton: false
                });
                fetchCartWishlistCount(); // Update navbar counters
            }
        },
        error: (xhr) => {
            hideLoader();
            if (xhr.status === 401) {
                handleAuthError(
                    "Not Logged In",
                    "You need to log in to add items to your wishlist."
                );
            } else {
                Swal.fire({
                    title: "Error",
                    text: "There was an error adding the product to your wishlist.",
                    icon: "error",
                    timer: 2000,
                    showConfirmButton: false
                });
            }
        }
    });
}
function addToCart(productId) {
    showLoader();
    $.ajax({
        url: '/addToCart',
        method: 'POST',
        data: { productId: productId },
        success: (response) => {
            hideLoader();
            if (response.status) {
                Swal.fire({
                    title: 'Added to Cart',
                    text: response.message,
                    icon: 'success',
                    showCancelButton: true,
                    confirmButtonText: 'Go to Cart',
                    cancelButtonText: 'OK',
                    timer: 2000
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = '/cart';
                    }
                    fetchCartWishlistCount();
                });
            } else {
                Swal.fire({
                    title: 'Error',
                    text: response.message || 'Unable to add to cart',
                    icon: 'error',
                    timer: 2000,
                    showConfirmButton: false
                });
            }
        },
        error: (xhr) => {
            hideLoader();
            if (xhr.status === 401) {
                handleAuthError(
                    'Not Logged In',
                    'You need to log in to add items to your cart.'
                );
            } else {
                Swal.fire({
                    title: 'Error',
                    text: 'Stock limit reached or maximum 5 items per user',
                    icon: 'error',
                    timer: 2000,
                    showConfirmButton: false
                });
            }
        }
    });
}
function addToCart1(productId) {
  $.ajax({
    url: '/addToCart',
    method: "POST",
    data: { productId: productId },
    success: (response) => {
      if (response.status) {
        Swal.fire({
			title: "Added to Cart",
			text: response.message,
			icon: "success",
			showCancelButton: true,  // Enables the second button
			confirmButtonText: "Cart", // Redirects to cart
			cancelButtonText: "OK",  // Closes the alert
			timer: 2000
		}).then((result) => {
            
			if (result.isConfirmed) {
				window.location.href = "/cart"; // Redirects to the cart page
			} else {
				location.reload(); // Reload to update cart UI
			}
		});

      } else {
        Swal.fire({
          title: "Error",
          text: response.message || "Unable to add to cart",
          icon: "error",
          timer: 2000,
          showConfirmButton: false
        });
        fetchCartWishlistCount();
      }
    },
    error: (xhr) => {
      if (xhr.status === 401) {
        handleAuthError(
          "Not Logged In",
          "You need to log in to add items to your cart."
        );
      } else {
        Swal.fire({
          title: "Error",
          text: "Stock limit reached or maximum 5 items per user",
          icon: "error",
          timer: 2000,
          showConfirmButton: false
        });
      }
    }
  });
}




    $(document).ready(function () {
        $(".hero__slider").owlCarousel({
            items: 1,
            loop: true,
            autoplay: true,
            autoplayTimeout: 3000,
            autoplayHoverPause: true,
            nav: false,
            dots: true,
            animateOut: 'fadeOut',
            animateIn: 'fadeIn'
        });

        $("#product_section_main").owlCarousel({
            items: 1,
            loop: true,
            autoplay: true,
            autoplayTimeout: 5000,
            autoplayHoverPause: true,
            nav: false,
            dots: true
        });
    });

    document.addEventListener('click', (e) => {
        const wishlistBtn = e.target.closest('.add-to-wishlist');
        if (wishlistBtn) {
            e.preventDefault();
            const productId = wishlistBtn.dataset.productId;
            addToWishlist(productId);
        }
    });
</script>